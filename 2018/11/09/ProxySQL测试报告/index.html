<!DOCTYPE html>
<html lang="">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="ProxySQL测试报告"/>




  <meta name="keywords" content="ProxySQL," />





  <link rel="alternate" href="/default" title="DBA Life">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="https://dbalife.info/2018/11/09/ProxySQL测试报告/"/>


<meta name="description" content="基本信息 ProxySQL 版本：v1.4.12 ProxySQL OS: CentOS7 压测工具：sysbench 后端server： mysql5.7.22, 一主一从架构 MySQL OS: CentOS6  ProxySQL 配置： ProxySQL的变量设置均为默认。   * mysql">
<meta name="keywords" content="ProxySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="ProxySQL测试报告">
<meta property="og:url" content="https://dbalife.info/2018/11/09/ProxySQL测试报告/index.html">
<meta property="og:site_name" content="DBA Life">
<meta property="og:description" content="基本信息 ProxySQL 版本：v1.4.12 ProxySQL OS: CentOS7 压测工具：sysbench 后端server： mysql5.7.22, 一主一从架构 MySQL OS: CentOS6  ProxySQL 配置： ProxySQL的变量设置均为默认。   * mysql">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://dbalife.info/images/ProxySQL-Readonly-QPS-QueryLog-on-off.png">
<meta property="og:image" content="https://dbalife.info/images/MySQL-ProxySQL-Readonly-QPS.png">
<meta property="og:image" content="https://dbalife.info/images/MySQL-ProxySQL-Readonly-Latency.png">
<meta property="og:image" content="https://dbalife.info/images/MySQL-ProxySQL-RW-proxysql_sysbench_on_the_same_node.png">
<meta property="og:image" content="https://dbalife.info/images/MySQL-ProxySQL-RW-proxysql_sysbench_seperate.png">
<meta property="og:image" content="https://dbalife.info/images/MySQL-ProxySQL-RW_mysql_using-ps.png">
<meta property="og:updated_time" content="2018-11-15T12:42:06.091Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ProxySQL测试报告">
<meta name="twitter:description" content="基本信息 ProxySQL 版本：v1.4.12 ProxySQL OS: CentOS7 压测工具：sysbench 后端server： mysql5.7.22, 一主一从架构 MySQL OS: CentOS6  ProxySQL 配置： ProxySQL的变量设置均为默认。   * mysql">
<meta name="twitter:image" content="https://dbalife.info/images/ProxySQL-Readonly-QPS-QueryLog-on-off.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>


  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: true
    },
  };
</script>




  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?91caa81bbeeba8e2b0e648131eccb041";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-121076689-1', 'auto');
        ga('send', 'pageview');
  </script>



    <title> ProxySQL测试报告 - DBA Life </title>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
   <script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-9508537112485384",
          enable_page_level_ads: true
     });
  </script>

  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">DBA Life</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/categories/MySQL/">
                            
                            
                                InnoTech
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/archives/">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about/">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary" class="home">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          ProxySQL测试报告
        
      </h1>

      <time class="post-time">
          Nov 09 2018
      </time>
    </header>



    
            <div class="post-content">
            <h4 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h4><p>ProxySQL 版本：v1.4.12<br>ProxySQL OS: CentOS7<br>压测工具：sysbench<br>后端server： mysql5.7.22, 一主一从架构<br>MySQL OS: CentOS6</p>
<h4 id="ProxySQL-配置："><a href="#ProxySQL-配置：" class="headerlink" title="ProxySQL 配置："></a>ProxySQL 配置：</h4><p>ProxySQL的变量设置均为默认。</p>
<ul>
<li><p>mysql_users表配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from mysql_users;</span><br><span class="line">+----------+-------------------------------------------+--------+---------+-------------------+----------------+---------------+------------------------+--------------+---------+----------+-----------------+</span><br><span class="line">| username | password                                  | active | use_ssl | default_hostgroup | default_schema | schema_locked | transaction_persistent | fast_forward | backend | frontend | max_connections |</span><br><span class="line">+----------+-------------------------------------------+--------+---------+-------------------+----------------+---------------+------------------------+--------------+---------+----------+-----------------+</span><br><span class="line">| test     | *94BDCEBE19083CE2A1F959FD02F964C7AF4CFC29 | 1      | 0       | 0                 |                | 0             | 1                      | 0            | 0       | 1        | 10000           |</span><br><span class="line">| test     | *94BDCEBE19083CE2A1F959FD02F964C7AF4CFC29 | 1      | 0       | 0                 |                | 0             | 1                      | 0            | 1       | 0        | 10000           |</span><br><span class="line">+----------+-------------------------------------------+--------+---------+-------------------+----------------+---------------+------------------------+--------------+---------+----------+-----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>mysql_servers表配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from mysql_servers;</span><br><span class="line">+--------------+-----------------+------+--------+--------+-------------+-----------------+---------------------+---------+----------------+------------+</span><br><span class="line">| hostgroup_id | hostname        | port | status | weight | compression | max_connections | max_replication_lag | use_ssl | max_latency_ms | comment    |</span><br><span class="line">+--------------+-----------------+------+--------+--------+-------------+-----------------+---------------------+---------+----------------+------------+</span><br><span class="line">| 0            | 192.168.216.203 | 3306 | ONLINE | 1      | 0           | 1000            | 0                   | 0       | 0              |            |</span><br><span class="line">| 1            | 192.168.216.204 | 3306 | ONLINE | 4      | 0           | 1000            | 30                  | 0       | 0              |            |</span><br><span class="line">+--------------+-----------------+------+--------+--------+-------------+-----------------+---------------------+---------+----------------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>主库： 192.168.216.203   对应主机组0<br>从库： 192.168.216.204   对应主机组1</p>
</li>
<li>mysql_query_rules配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from mysql_query_rules;</span><br><span class="line">+---------+--------+----------+------------+--------+-------------+------------+------------+--------+----------------------+---------------+----------------------+--------------+---------+-----------------+-----------------------+-----------+-----------+---------+---------+-------+-------------------+----------------+------------------+-----------+--------+-------------+-----------+-----+-------+---------+</span><br><span class="line">| rule_id | active | username | schemaname | flagIN | client_addr | proxy_addr | proxy_port | digest | match_digest         | match_pattern | negate_match_pattern | re_modifiers | flagOUT | replace_pattern | destination_hostgroup | cache_ttl | reconnect | timeout | retries | delay | next_query_flagIN | mirror_flagOUT | mirror_hostgroup | error_msg | OK_msg | sticky_conn | multiplex | log | apply | comment |</span><br><span class="line">+---------+--------+----------+------------+--------+-------------+------------+------------+--------+----------------------+---------------+----------------------+--------------+---------+-----------------+-----------------------+-----------+-----------+---------+---------+-------+-------------------+----------------+------------------+-----------+--------+-------------+-----------+-----+-------+---------+</span><br><span class="line">| 1       | 1      | NULL     | NULL       | 0      | NULL        | NULL       | NULL       | .      | NULL                 | NULL          | 0                    | CASELESS     | NULL    | NULL            | NULL                  | NULL      | NULL      | NULL    | NULL    | NULL  | NULL              | NULL           | NULL             | NULL      | NULL   | NULL        | NULL      | 1   | 0     | NULL    |</span><br><span class="line">| 20      | 1      | NULL     | NULL       | 0      | NULL        | NULL       | NULL       | NULL   | ^SELECT.*FOR UPDATE$ | NULL          | 0                    | CASELESS     | NULL    | NULL            | 0                     | NULL      | NULL      | NULL    | NULL    | NULL  | NULL              | NULL           | NULL             | NULL      | NULL   | NULL        | NULL      | 1   | 1     | NULL    |</span><br><span class="line">| 30      | 1      | NULL     | NULL       | 0      | NULL        | NULL       | NULL       | NULL   | ^SELECT              | NULL          | 0                    | CASELESS     | NULL    | NULL            | 1                     | NULL      | NULL      | NULL    | NULL    | NULL  | NULL              | NULL           | NULL             | NULL      | NULL   | NULL        | NULL      | 1   | 1     | NULL    |</span><br><span class="line">+---------+--------+----------+------------+--------+-------------+------------+------------+--------+----------------------+---------------+----------------------+--------------+---------+-----------------+-----------------------+-----------+-----------+---------+---------+-------+-------------------+----------------+------------------+-----------+--------+-------------+-----------+-----+-------+---------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>未配置表mysql_replication_hostgroups，禁止proxysql依据mysql的read_only属性更改主机组。主要是防止从机该属性被误改，造成写操作发送到从库。<br>另外需要注意，若不配置表mysql_replication_hostgroups，mysql-monitor_writer_is_also_reader=true不能正常工作。</p>
<h4 id="功能测试"><a href="#功能测试" class="headerlink" title="功能测试"></a>功能测试</h4><p>为验证测试语句分发，后端mysql主从都开启了general_log.</p>
<p><strong>基于MySQL主从global autocommit=1。MySQLglobal autocommit=0时有诸多莫名其妙的问题</strong>。</p>
<p>登陆ProxySQL 6033端口</p>
<h5 id="1-测试简单查询："><a href="#1-测试简单查询：" class="headerlink" title="1. 测试简单查询："></a>1. 测试简单查询：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from sbtest1 limit 4;</span><br><span class="line">+----+---------+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+</span><br><span class="line">| id | k       | c                                                                                                                       | pad                                                         |</span><br><span class="line">+----+---------+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+</span><br><span class="line">|  1 |       2 | 68487932199-96439406143-93774651418-41631865787-96406072701-20604855487-25459966574-28203206787-41238978918-19503783441 | 22195207048-70116052123-74140395089-76317954521-98694025897 |</span><br><span class="line">|  2 |      99 | 13241531885-45658403807-79170748828-69419634012-13605813761-77983377181-01582588137-21344716829-87370944992-02457486289 | 28733802923-10548894641-11867531929-71265603657-36546888392 |</span><br><span class="line">|  3 | 4989423 | 51185622598-89397522786-28007882305-52050087550-68686337807-48942386476-96555734557-05264042377-33586177817-31986479495 | 00592560354-80393027097-78244247549-39135306455-88936868384 |</span><br><span class="line">|  4 |      33 | 54133149494-75722987476-23015721680-47254589498-40242947469-55055884969-23675271222-20181439230-74473404563-55407972672 | 88488171626-98596569412-94026374972-58040528656-38000028170 |</span><br><span class="line">+----+---------+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>在管理界面可以看到该查询路由到了reader group。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+------------+----------+--------------------+-------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname | username | digest             | digest_text                   | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+------------+----------+--------------------+-------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 1         | test       | test     | 0x33BBFAE7731547BC | select * from sbtest1 limit ? | 1          | 1541224735 | 1541224735 | 3402     | 3402     | 3402     |</span><br><span class="line">+-----------+------------+----------+--------------------+-------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<h5 id="2-测试set-autocommit-0"><a href="#2-测试set-autocommit-0" class="headerlink" title="2. 测试set autocommit=0"></a>2. 测试set autocommit=0</h5><p>在ProxySQL Client接口执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set autocommit=0;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>在管理界面查看路由,显示发送到了writer group：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+------------+----------+--------------------+------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname | username | digest             | digest_text      | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+------------+----------+--------------------+------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 0         | test       | test     | 0x2FB86F938EF30630 | set autocommit=? | 1          | 1541225055 | 1541225055 | 0        | 0        | 0        |</span><br><span class="line">+-----------+------------+----------+--------------------+------------------+------------+------------+------------+----------+----------+----------+</span><br></pre></td></tr></table></figure></p>
<p>但在主从的general log中都没有看到该语句。该语句并没有真正分发到后台。<br>再执行查询：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from sbtest1 limit 1;</span><br><span class="line">+----+---+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+</span><br><span class="line">| id | k | c                                                                                                                       | pad                                                         |</span><br><span class="line">+----+---+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+</span><br><span class="line">|  1 | 2 | 68487932199-96439406143-93774651418-41631865787-96406072701-20604855487-25459966574-28203206787-41238978918-19503783441 | 22195207048-70116052123-74140395089-76317954521-98694025897 |</span><br><span class="line">+----+---+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>查看SQL路由：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+------------+----------+--------------------+-------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname | username | digest             | digest_text                   | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+------------+----------+--------------------+-------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 1         | test       | test     | 0x33BBFAE7731547BC | select * from sbtest1 limit ? | 1          | 1541225087 | 1541225087 | 2960     | 2960     | 2960     |</span><br><span class="line">| 0         | test       | test     | 0x2FB86F938EF30630 | set autocommit=?              | 1          | 1541225055 | 1541225055 | 0        | 0        | 0        |</span><br><span class="line">+-----------+------------+----------+--------------------+-------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure></p>
<p>显示该语句发送到了reader group，在从库的general log中确实收到了该语句，但set autocommit=0没有随之分发。  在ProxySQL client接口执行commit; 未发送到后端任何server.</p>
<p><strong>总结：对于简单查询直接发送SQL即可，执行set autocommit=0;select … from table ; commit;没有意义。</strong></p>
<h5 id="3-DML，select综合测试"><a href="#3-DML，select综合测试" class="headerlink" title="3. DML，select综合测试"></a>3. DML，select综合测试</h5><p>接着上面继续测试，在proxysql client端执行show tables; 在mysql主库的general log中发现set autocommit=0;出现在了show tables 前面，此时连接的autocommit已经关闭了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+----------------+</span><br><span class="line">| Tables_in_test |</span><br><span class="line">+----------------+</span><br><span class="line">| sbtest1        |</span><br><span class="line">| sbtest2        |</span><br><span class="line">| sbtest3        |</span><br><span class="line">| sbtest4        |</span><br><span class="line">| sbtest5        |</span><br><span class="line">+----------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &apos;autocommit&apos;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| autocommit    | OFF   |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>再次执行select 查询，仍然发送到从库。执行update语句，分发到主库，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update sbtest1 set k=9 where id =3;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br></pre></td></tr></table></figure></p>
<p>同时可看到后端连接与前端绑定，至此一个事务算是开始了。后面的所有SQL都会使用同一个连接。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show full processlist;</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| ThreadID | SessionID | user | db   | cli_host  | cli_port | hostgroup | l_srv_host      | l_srv_port | srv_host        | srv_port | command | time_ms | info |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| 1        | 1025087   | test | test | 127.0.0.1 | 42042    | 0         | 192.168.216.146 | 57418      | 192.168.216.203 | 3306     | Sleep   | 6150    |      |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>执行Select , 发送到主库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from sbtest1 where id=3;</span><br><span class="line">+----+---+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+</span><br><span class="line">| id | k | c                                                                                                                       | pad                                                         |</span><br><span class="line">+----+---+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+</span><br><span class="line">|  3 | 9 | 51185622598-89397522786-28007882305-52050087550-68686337807-48942386476-96555734557-05264042377-33586177817-31986479495 | 00592560354-80393027097-78244247549-39135306455-88936868384 |</span><br><span class="line">+----+---+-------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">第三条记录，显示select发送到了writer group,同时主库的general log中收到了此SQL。</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+--------------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname         | username | digest             | digest_text                        | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+--------------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 0         | test               | test     | 0x0724CA2D4ED1C95A | update sbtest1 set k=? where id =? | 1          | 1541226725 | 1541226725 | 5319     | 5319     | 5319     |</span><br><span class="line">| 0         | test               | test     | 0xB06310E983BD5E0B | show variables like ?              | 1          | 1541226250 | 1541226250 | 6335     | 6335     | 6335     |</span><br><span class="line">| 0         | test               | test     | 0x5662D7CF0442E794 | select * from sbtest1 where id=?   | 1          | 1541226804 | 1541226804 | 2848     | 2848     | 2848     |</span><br><span class="line">| 1         | test               | test     | 0x5662D7CF0442E794 | select * from sbtest1 where id=?   | 2          | 1541226103 | 1541226577 | 5370     | 2470     | 2900     |</span><br><span class="line">| 0         | test               | test     | 0x99531AEFF718C501 | show tables                        | 3          | 1541226077 | 1541226224 | 4420     | 479      | 2905     |</span><br><span class="line">| 0         | test               | test     | 0x02033E45904D3DF0 | show databases                     | 1          | 1541226077 | 1541226077 | 1386     | 1386     | 1386     |</span><br><span class="line">| 1         | information_schema | test     | 0x620B328FE9D6D71A | SELECT DATABASE()                  | 1          | 1541226077 | 1541226077 | 1968     | 1968     | 1968     |</span><br><span class="line">| 0         | information_schema | test     | 0x02033E45904D3DF0 | show databases                     | 1          | 1541226076 | 1541226076 | 3595     | 3595     | 3595     |</span><br><span class="line">| 0         | information_schema | test     | 0x226CD90D52A2BA0B | select @@version_comment limit ?   | 1          | 1541226072 | 1541226072 | 0        | 0        | 0        |</span><br><span class="line">| 0         | test               | test     | 0xDB3A841EF5443C35 | commit                             | 2          | 1541225672 | 1541226112 | 0        | 0        | 0        |</span><br><span class="line">| 1         | test               | test     | 0x33BBFAE7731547BC | select * from sbtest1 limit ?      | 1          | 1541225086 | 1541225086 | 2960     | 2960     | 2960     |</span><br><span class="line">| 0         | test               | test     | 0x2FB86F938EF30630 | set autocommit=?                   | 2          | 1541225054 | 1541226095 | 0        | 0        | 0        |</span><br><span class="line">+-----------+--------------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">12 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">查看连接，前后端依然处于绑定状态：</span><br><span class="line">mysql&gt; show full processlist;</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| ThreadID | SessionID | user | db   | cli_host  | cli_port | hostgroup | l_srv_host      | l_srv_port | srv_host        | srv_port | command | time_ms | info |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| 1        | 1025087   | test | test | 127.0.0.1 | 42042    | 0         | 192.168.216.146 | 57418      | 192.168.216.203 | 3306     | Sleep   | 197602  |      |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>执行commit;发送到主库，事务结束了，连接绑定断开了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show full processlist;</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+------------+------------+----------+----------+---------+---------+------+</span><br><span class="line">| ThreadID | SessionID | user | db   | cli_host  | cli_port | hostgroup | l_srv_host | l_srv_port | srv_host | srv_port | command | time_ms | info |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+------------+------------+----------+----------+---------+---------+------+</span><br><span class="line">| 1        | 1025087   | test | test | 127.0.0.1 | 42042    | 0         |            |            |          |          | Sleep   | 5249    |      |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+------------+------------+----------+----------+---------+---------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>再次查看autocommit连接属性,发现依然是关闭状态。说明后端连接没有随事务的结束而销毁。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &apos;autocommit&apos;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| autocommit    | OFF   |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>退出proxysql client接口，重新登陆后再次查看autocommit属性，发现是开启状态，与全局默认一致。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Your MySQL connection id is 1029467</span><br><span class="line">Server version: 5.5.30 (ProxySQL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &apos;autocommit&apos;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| autocommit    | ON    |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure></p>
<p>说明此时连接被销毁或重置！</p>
<p><strong>总结：set autocommit=0;不会自动开启事务。该语句不会立刻分发到后端mysql，它会在proxysql中暂存，等待下一条语句。如果下一条语句是select，则不会随之分发，该select语句仍然会受路由规则的支配发送reader group。直到遇到show .., dml语句，call procedure等，set autocommit=0;才会随之分发。但只有遇到dml语句，才会发生后端连接与前端连接绑定（mysql_users.transaction_persistent=1），一个隐性事务开启了，后面的无论什么语句都会用这同一个连接发送到同一台后端server,直到commit事务结束。</strong></p>
<h5 id="4-测试start-transaction"><a href="#4-测试start-transaction" class="headerlink" title="4. 测试start transaction."></a>4. 测试start transaction.</h5><p>在ProxySQL client接口中执行 start transaction：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>在ProxySQL admin interface即可看到，该语句被发送到主库。同时在主库的general_log中也可确认收到了此语句。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+--------------------+----------+--------------------+-------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname         | username | digest             | digest_text       | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+--------------------+----------+--------------------+-------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 0         | information_schema | test     | 0x326F4F2B935EC266 | start transaction | 1          | 1541231534 | 1541231534 | 1590     | 1590     | 1590     |</span><br><span class="line">+-----------+--------------------+----------+--------------------+-------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>后端连接与前端连接也发生了绑定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show full processlist;</span><br><span class="line">+----------+-----------+------+--------------------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| ThreadID | SessionID | user | db                 | cli_host  | cli_port | hostgroup | l_srv_host      | l_srv_port | srv_host        | srv_port | command | time_ms | info |</span><br><span class="line">+----------+-----------+------+--------------------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| 3        | 1030130   | test | information_schema | 127.0.0.1 | 43974    | 0         | 192.168.216.146 | 57418      | 192.168.216.203 | 3306     | Sleep   | 8487    |      |</span><br><span class="line">+----------+-----------+------+--------------------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>接下来的任何语句都会发送到主库,直到commit：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+--------------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname         | username | digest             | digest_text                        | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+--------------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 0         | test               | test     | 0x0724CA2D4ED1C95A | update sbtest1 set k=? where id =? | 1          | 1541231786 | 1541231786 | 10978    | 10978    | 10978    |</span><br><span class="line">| 0         | test               | test     | 0x99531AEFF718C501 | show tables                        | 2          | 1541231767 | 1541231770 | 2137     | 651      | 1486     |</span><br><span class="line">| 0         | test               | test     | 0x02033E45904D3DF0 | show databases                     | 1          | 1541231767 | 1541231767 | 4067     | 4067     | 4067     |</span><br><span class="line">| 0         | information_schema | test     | 0x620B328FE9D6D71A | SELECT DATABASE()                  | 1          | 1541231767 | 1541231767 | 1239     | 1239     | 1239     |</span><br><span class="line">| 0         | information_schema | test     | 0x38AB7C0A6E61A415 | select * from test.sbtest1 limit ? | 1          | 1541231758 | 1541231758 | 4678     | 4678     | 4678     |</span><br><span class="line">| 0         | information_schema | test     | 0x326F4F2B935EC266 | start transaction                  | 1          | 1541231535 | 1541231535 | 1590     | 1590     | 1590     |</span><br><span class="line">+-----------+--------------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>总结：start transaction … commit是没有问题的。同一事务的SQL都能保证发送到一个server执行。</p>
<h5 id="5-测试start-transaction-read-only"><a href="#5-测试start-transaction-read-only" class="headerlink" title="5. 测试start transaction read only"></a>5. 测试start transaction read only</h5><p>在ProxySQL中执行start transaction read only;会被发送到writer group(主库)，并且发生与start transaction一样的事情。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+------------+----------+--------------------+-----------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname | username | digest             | digest_text                 | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+------------+----------+--------------------+-----------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 0         | test       | test     | 0x9ED889E5AC870104 | start transaction read only | 1          | 1541232046 | 1541232046 | 817      | 817      | 817      |</span><br><span class="line">+-----------+------------+----------+--------------------+-----------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show full processlist;</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| ThreadID | SessionID | user | db   | cli_host  | cli_port | hostgroup | l_srv_host      | l_srv_port | srv_host        | srv_port | command | time_ms | info |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| 3        | 1030130   | test | test | 127.0.0.1 | 43974    | 0         | 192.168.216.146 | 57418      | 192.168.216.203 | 3306     | Sleep   | 41541   |      |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p><strong>这意味着客户端使用start transaction read only 开启只读事务时，ProxySQL不会自动将它发送到reader group，而是按照我们既定的路由规则，依然发送到了writer group（主库）。一种迂回的办法是新建一条rule, 指定start transaction read only,发送到从库。这个办法是可行的。</strong></p>
<p>管理界面插入规则：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into mysql_query_rules (rule_id,active,match_digest,destination_hostgroup,apply) values (2,1,&apos;start transaction read only&apos;,1,1);</span><br><span class="line">load mysql query rules to run;</span><br></pre></td></tr></table></figure></p>
<p>在ProxySQL客户端执行start transaction read only,后查看路由：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">第一条，走向了(reader group)从库</span><br><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+------------+----------+--------------------+-----------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname | username | digest             | digest_text                 | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+------------+----------+--------------------+-----------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 1         | test       | test     | 0x9ED889E5AC870104 | start transaction read only | 1          | 1541232482 | 1541232482 | 1407     | 1407     | 1407     |</span><br><span class="line">| 0         | test       | test     | 0xDB3A841EF5443C35 | commit                      | 1          | 1541232196 | 1541232196 | 1492     | 1492     | 1492     |</span><br><span class="line">| 0         | test       | test     | 0x9ED889E5AC870104 | start transaction read only | 1          | 1541232045 | 1541232045 | 817      | 817      | 817      |</span><br><span class="line">+-----------+------------+----------+--------------------+-----------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">连接也与从库的连接发生了绑定。</span><br><span class="line">mysql&gt; show full processlist;</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| ThreadID | SessionID | user | db   | cli_host  | cli_port | hostgroup | l_srv_host      | l_srv_port | srv_host        | srv_port | command | time_ms | info |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| 3        | 1030130   | test | test | 127.0.0.1 | 43974    | 1         | 192.168.216.146 | 58392      | 192.168.216.204 | 3306     | Sleep   | 7869    |      |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>接下来的任何语句都会路由到同一个server（从库）（当然dml语句会报错）直到commit .</p>
<h5 id="6-测试begin-commit"><a href="#6-测试begin-commit" class="headerlink" title="6. 测试begin/commit;"></a>6. 测试begin/commit;</h5><p>begin/commit,能够正常工作，依照路由规则，begin会被立刻发送到writer group(主库)并发送后端与前端的连接绑定，直到commit,绑定释放。其间的所有SQL都会使用同一个连接发送。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+------------+----------+--------------------+---------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname | username | digest             | digest_text                           | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+------------+----------+--------------------+---------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 0         | test       | test     | 0xDB3A841EF5443C35 | commit                                | 1          | 1541233741 | 1541233741 | 4749     | 4749     | 4749     |</span><br><span class="line">| 0         | test       | test     | 0x267506D910073804 | update sbtest1 set k = ? where id = ? | 1          | 1541233734 | 1541233734 | 2599     | 2599     | 2599     |</span><br><span class="line">| 0         | test       | test     | 0x33BBFAE7731547BC | select * from sbtest1 limit ?         | 1          | 1541233713 | 1541233713 | 2848     | 2848     | 2848     |</span><br><span class="line">| 0         | test       | test     | 0x99531AEFF718C501 | show tables                           | 1          | 1541233707 | 1541233707 | 2703     | 2703     | 2703     |</span><br><span class="line">| 0         | test       | test     | 0xA592C94A099E89DC | begin                                 | 1          | 1541233702 | 1541233702 | 862      | 862      | 862      |</span><br><span class="line">+-----------+------------+----------+--------------------+---------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">5 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure></p>
<h5 id="7-测试set-transaction-read-write-read-only"><a href="#7-测试set-transaction-read-write-read-only" class="headerlink" title="7. 测试set transaction read write [read only]"></a>7. 测试set transaction read write [read only]</h5><p>set transaction 有session和global两种scope, 它用来设置当前session or global事务的属性（Global scope 会设置数据库变量：transaction_read_only，会影响新连接；Session scope则只影响下一个事务。）。</p>
<ul>
<li>set transaction read write会设置当前session后续的事务可读可写；而set transaction read only则当前session后续的事务必须是只读，直到commit,它的作用才结束（与start transaction read only是一样的）。</li>
<li>set global transaction read only[read write], 则设置了除本session 外的的其它后续连接session的事务属性。该语句执行后，新建的连接只能查询,无法执行dml语句,虽然read_only=OFF！</li>
</ul>
<p>因为发现有些应用的数据层框架会给数据库发送这类语句，故在此也测一下。</p>
<p>在ProxySQL client 端执行set transaction read write。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname | username | digest             | digest_text                        | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 0         | test       | test     | 0x0724CA2D4ED1C95A | update sbtest1 set k=? where id =? | 1          | 1541234408 | 1541234408 | 5583     | 5583     | 5583     |</span><br><span class="line">| 1         | test       | test     | 0xD70A9BB359FD8BDB | select * from sbtest1 where id =?  | 1          | 1541234349 | 1541234349 | 3292     | 3292     | 3292     |</span><br><span class="line">| 0         | test       | test     | 0x99531AEFF718C501 | show tables                        | 1          | 1541234337 | 1541234337 | 1070     | 1070     | 1070     |</span><br><span class="line">| 0         | test       | test     | 0x44AF4E6A00440DCD | set transaction read write         | 1          | 1541234318 | 1541234318 | 991      | 991      | 991      |</span><br><span class="line">+-----------+------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">4 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure></p>
<p>set transaction read write 会被立刻发送到主库，并不发生前后端的连接绑定，后续的SQL也都按照既定的路由规则分发，因为autocommit=1。它不起什么作用，因为一个session中的事务属性默认就是读写。</p>
<p>set transaction read only 同样会立刻发送到主库，后续执行update则报错。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set transaction read only;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; update sbtest1 set k=1 where id=1;</span><br><span class="line">ERROR 1792 (25006): Cannot execute statement in a READ ONLY transaction.</span><br></pre></td></tr></table></figure></p>
<p><strong>它与start transaction read only问题相同，ProxySQL不能依此识别只读事务，并路由到从库。set transaction read only会设置本session下一个事务是只读的,commit后作用结束!</strong></p>
<p>结合set autocommit=0, set transaction read write可以实现与start transaction的作用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set autocommit=0;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">执行完此句后，set autocommit=0与之一起发送到主库</span><br><span class="line">mysql&gt; set transaction read write;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>此时已发生前后端连接绑定，后续所有query都使用同一连接发送到后端同一server！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show full processlist;</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| ThreadID | SessionID | user | db   | cli_host  | cli_port | hostgroup | l_srv_host      | l_srv_port | srv_host        | srv_port | command | time_ms | info |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">| 1        | 47        | test | test | 127.0.0.1 | 56982    | 0         | 192.168.216.101 | 40146      | 192.168.216.203 | 3306     | Sleep   | 56539   |      |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+-----------------+------------+-----------------+----------+---------+---------+------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname | username | digest             | digest_text                        | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 0         | test       | test     | 0x0724CA2D4ED1C95A | update sbtest1 set k=? where id =? | 1          | 1541382746 | 1541382746 | 159859   | 159859   | 159859   |</span><br><span class="line">| 0         | test       | test     | 0x33BBFAE7731547BC | select * from sbtest1 limit ?      | 2          | 1541382722 | 1541382749 | 35264    | 917      | 34347    |</span><br><span class="line">| 0         | test       | test     | 0x44AF4E6A00440DCD | set transaction read write         | 1          | 1541382603 | 1541382603 | 11176    | 11176    | 11176    |</span><br><span class="line">| 0         | test       | test     | 0x2FB86F938EF30630 | set autocommit=?                   | 1          | 1541382572 | 1541382572 | 0        | 0        | 0        |</span><br><span class="line">+-----------+------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">4 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure></p>
<p>执行commit 后事务结束, 但发现前后端连接依然处于绑定状态。后续执行的查询依然使用这一连接发送到后端同一server.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from stats_mysql_query_digest;</span><br><span class="line">+-----------+------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| hostgroup | schemaname | username | digest             | digest_text                        | count_star | first_seen | last_seen  | sum_time | min_time | max_time |</span><br><span class="line">+-----------+------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">| 0         | test       | test     | 0x086920192A3AEE28 | select * from sbtest2 limit ?      | 1          | 1541382912 | 1541382912 | 24196    | 24196    | 24196    |</span><br><span class="line">| 0         | test       | test     | 0xDB3A841EF5443C35 | commit                             | 1          | 1541382773 | 1541382773 | 36238    | 36238    | 36238    |</span><br><span class="line">| 0         | test       | test     | 0x0724CA2D4ED1C95A | update sbtest1 set k=? where id =? | 1          | 1541382746 | 1541382746 | 159859   | 159859   | 159859   |</span><br><span class="line">| 0         | test       | test     | 0x33BBFAE7731547BC | select * from sbtest1 limit ?      | 4          | 1541382722 | 1541382897 | 37871    | 917      | 34347    |</span><br><span class="line">| 0         | test       | test     | 0x44AF4E6A00440DCD | set transaction read write         | 1          | 1541382603 | 1541382603 | 11176    | 11176    | 11176    |</span><br><span class="line">| 0         | test       | test     | 0x2FB86F938EF30630 | set autocommit=?                   | 1          | 1541382572 | 1541382572 | 0        | 0        | 0        |</span><br><span class="line">+-----------+------------+----------+--------------------+------------------------------------+------------+------------+------------+----------+----------+----------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>执行set autocommit=1后，通过主库的general log发现该语句立刻发送到了主库（并不在ProxySQL中暂存,因为前后端连接处于绑定状态，ProxySQL有充分的自信发送这条set autocommit=1;），<strong>而且发送了两次</strong>！并且ProxySQL中前后端连接绑定状态断开了。<br>主库的general log片段：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018-11-05T02:02:52.578436Z	  623 Query	select * from sbtest1 limit 1</span><br><span class="line">2018-11-05T02:03:07.577225Z	  623 Query	select * from sbtest2 limit 1</span><br><span class="line">2018-11-05T02:04:26.714266Z	  623 Query	SET autocommit=1</span><br><span class="line">2018-11-05T02:04:26.715078Z	  623 Query	set autocommit=1</span><br></pre></td></tr></table></figure></p>
<p>ProxySQL admin interface查看Processlist<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show full processlist;</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+------------+------------+----------+----------+---------+---------+------+</span><br><span class="line">| ThreadID | SessionID | user | db   | cli_host  | cli_port | hostgroup | l_srv_host | l_srv_port | srv_host | srv_port | command | time_ms | info |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+------------+------------+----------+----------+---------+---------+------+</span><br><span class="line">| 1        | 47        | test | test | 127.0.0.1 | 56982    | 0         |            |            |          |          | Sleep   | 104518  |      |</span><br><span class="line">+----------+-----------+------+------+-----------+----------+-----------+------------+------------+----------+----------+---------+---------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p><strong>总结：set transaction read write 结合set autocommit=0,可以使前后端连接绑定，确保同一事务的所有SQL发送到同一server,但这种绑定并不能随事务的commit而结束，而是随下次设置set autcocommit=1而结束。ProxySQL处理set transaction read write还是有许多不确定性因素！应用端框架最好不要发送这类SQL，使用begin..commit;/start transaction .. commit; 是正规执行事务的方式,这会使ProxySQL更好的工作!</strong>   </p>
<p>Java JDBC使用set autocommit=0来隐式开启事务，由于set autocommit 默认会在proxysql端缓存，这会导致一些不符合预期的效果。 修改proxysql参数mysql-forward_autocommit=’true’, 可使set autocommit=0,不在proxysql中缓存，立刻转发到后端server. 根据默认路由规则，转发到写组。 这会使后端连接与前端绑定，确保了一个事务的所有SQL都使用同一个连接发送。 <a href="https://github.com/sysown/proxysql/issues/1155" target="_blank" rel="noopener">https://github.com/sysown/proxysql/issues/1155</a>  </p>
<h4 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h4><p>后端mysql为一主一从，在各压测用例中配置均保持一致！<br>sysbench 压测语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysbench /usr/local/share/sysbench/oltp_read_only.lua --mysql-host=127.0.0.1 --db-driver=mysql --mysql-port=6033 --mysql-db=test --mysql-user=test --mysql-password=test --table_size=10000000 --tables=5 --db-ps-mode=disable --skip-trx=on --threads=$thread  --time=120 --report-interval=20 run</span><br></pre></td></tr></table></figure></p>
<h5 id="1-ProxySQL-query-log-ON-与-OFF，Read-only-对比！"><a href="#1-ProxySQL-query-log-ON-与-OFF，Read-only-对比！" class="headerlink" title="1. ProxySQL query log ON 与 OFF，Read only 对比！"></a>1. ProxySQL query log ON 与 OFF，Read only 对比！</h5><p> query log开启 ,读写完全分离，写节点不承担读请求负载！(mysql general_log=ON)</p>
<p><img src="/images/ProxySQL-Readonly-QPS-QueryLog-on-off.png" alt="a"><br>可以看到ProxySQL的query log的开启对性能影响不太明显！</p>
<h5 id="2-读写完全分离，写节点承担25-的读请求，与直连mysql-read-only-对比"><a href="#2-读写完全分离，写节点承担25-的读请求，与直连mysql-read-only-对比" class="headerlink" title="2. 读写完全分离，写节点承担25%的读请求，与直连mysql,read only 对比"></a>2. 读写完全分离，写节点承担25%的读请求，与直连mysql,read only 对比</h5><p>ProxySQL 的缓存是关闭的，由于主从两个节点都承担了读请求，ProxySQL的QPS与直连mysql相比有50%的提升。<br><img src="/images/MySQL-ProxySQL-Readonly-QPS.png" alt="a"><br>请求Response time:<br><img src="/images/MySQL-ProxySQL-Readonly-Latency.png" alt="a"><br>ProxySQL 的平均响应时间，明显小于直连MySQL，会话越多越明显！</p>
<h5 id="3-TPS测试"><a href="#3-TPS测试" class="headerlink" title="3. TPS测试"></a>3. TPS测试</h5><p>测试采用read-write脚本，这更贴近正常的业务！在ProxySQL部署节点压测，这样可以模拟将proxySQL部署到应用节点的效果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysbench /usr/local/share/sysbench/oltp_read_write.lua --mysql-host=127.0.0.1 --db-driver=mysql --mysql-port=6033 --mysql-db=test --mysql-user=test --mysql-password=test --table_size=10000000 --tables=5 --db-ps-mode=disable --skip-trx=off --threads=$thread  --time=120 --report-interval=20 run</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/MySQL-ProxySQL-RW-proxysql_sysbench_on_the_same_node.png" alt="a"></p>
<p>测试结果显示，连接ProxySQL与直连mysqltps还高！sysbench连接ProxySQL属于本地环路连接，网络延时可以忽略。ProxySQL到后端mysql的网络延迟与sysbench直连mysql的网络延迟相同。但ProxySQL通过读写分离，将读的压力分到了从库，从而使主库的压力降低，故主库能有更高的tps. 另外ProxySQL使用连接池与后端MySQL维持一定数量的连接，这使得连接ProxySQL测试时，省掉了部分与后端mysql建立连接的开销，这也有助于提升性能。</p>
<p>下面将压测节点与ProxySQL部署节点分开再次压测ProxySQL，然后再次与直连mysql对比绘图。</p>
<p><img src="/images/MySQL-ProxySQL-RW-proxysql_sysbench_seperate.png" alt="a"></p>
<p>这种测试情况下，ProxySQL有两个网络延时，一个是sysbench到proxysql,一个是proxysql到mysql，但直连mysql 的性能还是有些低，比不上连接proxysqlSQL,可能是因为压测mysql时未启用prepare statement，mysql的性能未充分发挥出来. 去掉–db-ps-mode=disable后压测mysql,再试下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysbench /usr/local/share/sysbench/oltp_read_write.lua --mysql-host=192.168.216.203 --db-driver=mysql --mysql-port=3306 --mysql-db=test --mysql-user=test --mysql-password=test --table_size=10000000 --tables=5 --skip-trx=off  --threads=$thread  --time=120 --report-interval=20 run</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/MySQL-ProxySQL-RW_mysql_using-ps.png" alt="a"><br>由上图可以看到，当线程数小于100时，mysql tps性能高，大于100后，两者旗鼓相当。<br><strong>我得出的结论是ProxySQL性能极佳，对提升数据库整体性能有很大帮助！</strong>  各位看官，你们测的结果如何？</p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/ProxySQL/">ProxySQL</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2018/11/17/MySQL-filesort-算法探秘/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">MySQL filesort 算法探秘</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2018/11/02/xtrabackup增量备份造成磁盘Read-IO飙升记/">
        <span class="next-text nav-default">xtrabackup增量备份造成磁盘Read IO飙升记</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        



<div id="gcontainer"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
var gitment = new Gitment({
  id: 'ProxySQL测试报告', // 可选。默认为 location.href
  owner: 'mount565',
  repo: 'gitment-comments',
  oauth: {
    client_id: '09bfef25af96c2218b13',
    client_secret: '192a84d4a407523b4db0b65ffbef01098d2fefa3',
  },
})
gitment.render('gcontainer')
</script>




      </footer>
    
  </article>

    </div>
    <div id="secondary">
    
    <section id="widget-custom" class="widget-area">
    <br/>
      <!-- adsense code goes here  -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 200*200-view-ad -->
<ins class="adsbygoogle"
     style="display:inline-block;width:200px;height:200px"
     data-ad-client="ca-pub-9508537112485384"
     data-ad-slot="9398928824"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </section>


    
    <section id="tags" class="widget-area widget_categories">
        <h3 class="widget-title">Categories</h3>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyCAT/">MyCAT</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ProxySQL/">ProxySQL</a><span class="category-list-count">13</span></li></ul>
    </section>


    
    <section id="tags" class="widget-area widget_tags">
        <h3 class="widget-title">Tags</h3>
        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/MGR/">MGR</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OPS/">OPS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Group-Replication/">Group Replication</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL8/">MySQL8</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyCAT/">MyCAT</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Replication/">Replication</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HA/">HA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ProxySQL/">ProxySQL</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PXC/">PXC</a><span class="tag-list-count">1</span></li></ul>
    </section>


    
    <section id="widget-custom" class="widget-area">
        <h3 class="widget-title">Links</h3>
        <a href="http://bohr.me/" target="_blank">bohr</a>
    </section>


</div>


      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2017 -
    
    2019
    <span class="footer-author">William Wang.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
